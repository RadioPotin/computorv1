<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Coverage report</title>
    <link rel="stylesheet" href="../coverage.css" />
    <script src="../highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <meta charset="utf-8" />
  </head>
  <body>
    <div id="header">
      <h1>
        <a href="../index.html">
          <span class="dirname">src/</span>solver.ml
        </a>
      </h1>
      <h2>99.19%</h2>
    </div>
    <div id="navbar">
      <span class="unvisited" style="bottom:17.49%"></span>
    </div>
    <div id="report">
      <div id="lines-layer">
        <pre>
<a id="L1"></a><span > </span>
<a id="L2"></a><span > </span>
<a id="L3"></a><span > </span>
<a id="L4"></a><span > </span>
<a id="L5"></a><span > </span>
<a id="L6"></a><span > </span>
<a id="L7"></a><span > </span>
<a id="L8"></a><span > </span>
<a id="L9"></a><span > </span>
<a id="L10"></a><span class="visited"> </span>
<a id="L11"></a><span class="visited"> </span>
<a id="L12"></a><span class="visited"> </span>
<a id="L13"></a><span > </span>
<a id="L14"></a><span class="visited"> </span>
<a id="L15"></a><span > </span>
<a id="L16"></a><span class="visited"> </span>
<a id="L17"></a><span > </span>
<a id="L18"></a><span class="visited"> </span>
<a id="L19"></a><span > </span>
<a id="L20"></a><span > </span>
<a id="L21"></a><span > </span>
<a id="L22"></a><span > </span>
<a id="L23"></a><span class="visited"> </span>
<a id="L24"></a><span > </span>
<a id="L25"></a><span > </span>
<a id="L26"></a><span > </span>
<a id="L27"></a><span > </span>
<a id="L28"></a><span class="visited"> </span>
<a id="L29"></a><span class="visited"> </span>
<a id="L30"></a><span class="visited"> </span>
<a id="L31"></a><span > </span>
<a id="L32"></a><span > </span>
<a id="L33"></a><span > </span>
<a id="L34"></a><span > </span>
<a id="L35"></a><span > </span>
<a id="L36"></a><span > </span>
<a id="L37"></a><span > </span>
<a id="L38"></a><span > </span>
<a id="L39"></a><span > </span>
<a id="L40"></a><span > </span>
<a id="L41"></a><span > </span>
<a id="L42"></a><span > </span>
<a id="L43"></a><span > </span>
<a id="L44"></a><span > </span>
<a id="L45"></a><span > </span>
<a id="L46"></a><span > </span>
<a id="L47"></a><span > </span>
<a id="L48"></a><span > </span>
<a id="L49"></a><span > </span>
<a id="L50"></a><span > </span>
<a id="L51"></a><span > </span>
<a id="L52"></a><span > </span>
<a id="L53"></a><span > </span>
<a id="L54"></a><span > </span>
<a id="L55"></a><span > </span>
<a id="L56"></a><span > </span>
<a id="L57"></a><span class="visited"> </span>
<a id="L58"></a><span > </span>
<a id="L59"></a><span class="visited"> </span>
<a id="L60"></a><span > </span>
<a id="L61"></a><span class="visited"> </span>
<a id="L62"></a><span > </span>
<a id="L63"></a><span > </span>
<a id="L64"></a><span > </span>
<a id="L65"></a><span > </span>
<a id="L66"></a><span class="visited"> </span>
<a id="L67"></a><span class="visited"> </span>
<a id="L68"></a><span class="visited"> </span>
<a id="L69"></a><span > </span>
<a id="L70"></a><span class="visited"> </span>
<a id="L71"></a><span class="visited"> </span>
<a id="L72"></a><span class="visited"> </span>
<a id="L73"></a><span > </span>
<a id="L74"></a><span > </span>
<a id="L75"></a><span class="visited"> </span>
<a id="L76"></a><span class="visited"> </span>
<a id="L77"></a><span > </span>
<a id="L78"></a><span > </span>
<a id="L79"></a><span > </span>
<a id="L80"></a><span > </span>
<a id="L81"></a><span > </span>
<a id="L82"></a><span > </span>
<a id="L83"></a><span > </span>
<a id="L84"></a><span > </span>
<a id="L85"></a><span class="visited"> </span>
<a id="L86"></a><span > </span>
<a id="L87"></a><span > </span>
<a id="L88"></a><span class="visited"> </span>
<a id="L89"></a><span class="visited"> </span>
<a id="L90"></a><span class="visited"> </span>
<a id="L91"></a><span class="visited"> </span>
<a id="L92"></a><span > </span>
<a id="L93"></a><span > </span>
<a id="L94"></a><span > </span>
<a id="L95"></a><span > </span>
<a id="L96"></a><span > </span>
<a id="L97"></a><span > </span>
<a id="L98"></a><span > </span>
<a id="L99"></a><span > </span>
<a id="L100"></a><span > </span>
<a id="L101"></a><span > </span>
<a id="L102"></a><span class="visited"> </span>
<a id="L103"></a><span class="visited"> </span>
<a id="L104"></a><span > </span>
<a id="L105"></a><span class="visited"> </span>
<a id="L106"></a><span class="visited"> </span>
<a id="L107"></a><span > </span>
<a id="L108"></a><span class="visited"> </span>
<a id="L109"></a><span class="visited"> </span>
<a id="L110"></a><span class="visited"> </span>
<a id="L111"></a><span class="visited"> </span>
<a id="L112"></a><span > </span>
<a id="L113"></a><span class="visited"> </span>
<a id="L114"></a><span class="visited"> </span>
<a id="L115"></a><span class="visited"> </span>
<a id="L116"></a><span > </span>
<a id="L117"></a><span > </span>
<a id="L118"></a><span class="visited"> </span>
<a id="L119"></a><span > </span>
<a id="L120"></a><span class="visited"> </span>
<a id="L121"></a><span > </span>
<a id="L122"></a><span class="visited"> </span>
<a id="L123"></a><span class="visited"> </span>
<a id="L124"></a><span > </span>
<a id="L125"></a><span > </span>
<a id="L126"></a><span class="visited"> </span>
<a id="L127"></a><span > </span>
<a id="L128"></a><span class="visited"> </span>
<a id="L129"></a><span class="visited"> </span>
<a id="L130"></a><span class="visited"> </span>
<a id="L131"></a><span > </span>
<a id="L132"></a><span > </span>
<a id="L133"></a><span class="visited"> </span>
<a id="L134"></a><span > </span>
<a id="L135"></a><span class="visited"> </span>
<a id="L136"></a><span class="visited"> </span>
<a id="L137"></a><span > </span>
<a id="L138"></a><span class="visited"> </span>
<a id="L139"></a><span > </span>
<a id="L140"></a><span > </span>
<a id="L141"></a><span class="visited"> </span>
<a id="L142"></a><span class="visited"> </span>
<a id="L143"></a><span class="visited"> </span>
<a id="L144"></a><span class="visited"> </span>
<a id="L145"></a><span class="visited"> </span>
<a id="L146"></a><span class="visited"> </span>
<a id="L147"></a><span class="visited"> </span>
<a id="L148"></a><span > </span>
<a id="L149"></a><span class="visited"> </span>
<a id="L150"></a><span > </span>
<a id="L151"></a><span > </span>
<a id="L152"></a><span class="visited"> </span>
<a id="L153"></a><span > </span>
<a id="L154"></a><span > </span>
<a id="L155"></a><span > </span>
<a id="L156"></a><span > </span>
<a id="L157"></a><span > </span>
<a id="L158"></a><span class="visited"> </span>
<a id="L159"></a><span class="visited"> </span>
<a id="L160"></a><span class="visited"> </span>
<a id="L161"></a><span > </span>
<a id="L162"></a><span class="visited"> </span>
<a id="L163"></a><span > </span>
<a id="L164"></a><span > </span>
<a id="L165"></a><span class="visited"> </span>
<a id="L166"></a><span > </span>
<a id="L167"></a><span class="visited"> </span>
<a id="L168"></a><span > </span>
<a id="L169"></a><span class="visited"> </span>
<a id="L170"></a><span class="visited"> </span>
<a id="L171"></a><span class="visited"> </span>
<a id="L172"></a><span > </span>
<a id="L173"></a><span class="visited"> </span>
<a id="L174"></a><span class="visited"> </span>
<a id="L175"></a><span class="visited"> </span>
<a id="L176"></a><span > </span>
<a id="L177"></a><span class="visited"> </span>
<a id="L178"></a><span class="visited"> </span>
<a id="L179"></a><span class="visited"> </span>
<a id="L180"></a><span > </span>
<a id="L181"></a><span class="visited"> </span>
<a id="L182"></a><span > </span>
<a id="L183"></a><span class="visited"> </span>
<a id="L184"></a><span class="unvisited"> </span>
<a id="L185"></a><span class="visited"> </span>
<a id="L186"></a><span class="visited"> </span>
<a id="L187"></a><span > </span>
<a id="L188"></a><span class="visited"> </span>
<a id="L189"></a><span > </span>
<a id="L190"></a><span > </span>
<a id="L191"></a><span class="visited"> </span>
<a id="L192"></a><span class="visited"> </span>
<a id="L193"></a><span class="visited"> </span>
<a id="L194"></a><span class="visited"> </span>
<a id="L195"></a><span > </span>
<a id="L196"></a><span class="visited"> </span>
<a id="L197"></a><span > </span>
<a id="L198"></a><span > </span>
<a id="L199"></a><span > </span>
<a id="L200"></a><span > </span>
<a id="L201"></a><span class="visited"> </span>
<a id="L202"></a><span class="visited"> </span>
<a id="L203"></a><span > </span>
<a id="L204"></a><span > </span>
<a id="L205"></a><span > </span>
<a id="L206"></a><span class="visited"> </span>
<a id="L207"></a><span > </span>
<a id="L208"></a><span class="visited"> </span>
<a id="L209"></a><span class="visited"> </span>
<a id="L210"></a><span class="visited"> </span>
<a id="L211"></a><span > </span>
<a id="L212"></a><span > </span>
<a id="L213"></a><span class="visited"> </span>
<a id="L214"></a><span > </span>
<a id="L215"></a><span class="visited"> </span>
<a id="L216"></a><span > </span>
<a id="L217"></a><span > </span>
<a id="L218"></a><span class="visited"> </span>
<a id="L219"></a><span class="visited"> </span>
<a id="L220"></a><span > </span>
<a id="L221"></a><span class="visited"> </span>
<a id="L222"></a><span class="visited"> </span>
<a id="L223"></a><span class="visited"> </span>
</pre>
      </div>
      <div id="text-layer">
        <pre id="line-numbers">
<a href="#L1">  1</a>
<a href="#L2">  2</a>
<a href="#L3">  3</a>
<a href="#L4">  4</a>
<a href="#L5">  5</a>
<a href="#L6">  6</a>
<a href="#L7">  7</a>
<a href="#L8">  8</a>
<a href="#L9">  9</a>
<a href="#L10"> 10</a>
<a href="#L11"> 11</a>
<a href="#L12"> 12</a>
<a href="#L13"> 13</a>
<a href="#L14"> 14</a>
<a href="#L15"> 15</a>
<a href="#L16"> 16</a>
<a href="#L17"> 17</a>
<a href="#L18"> 18</a>
<a href="#L19"> 19</a>
<a href="#L20"> 20</a>
<a href="#L21"> 21</a>
<a href="#L22"> 22</a>
<a href="#L23"> 23</a>
<a href="#L24"> 24</a>
<a href="#L25"> 25</a>
<a href="#L26"> 26</a>
<a href="#L27"> 27</a>
<a href="#L28"> 28</a>
<a href="#L29"> 29</a>
<a href="#L30"> 30</a>
<a href="#L31"> 31</a>
<a href="#L32"> 32</a>
<a href="#L33"> 33</a>
<a href="#L34"> 34</a>
<a href="#L35"> 35</a>
<a href="#L36"> 36</a>
<a href="#L37"> 37</a>
<a href="#L38"> 38</a>
<a href="#L39"> 39</a>
<a href="#L40"> 40</a>
<a href="#L41"> 41</a>
<a href="#L42"> 42</a>
<a href="#L43"> 43</a>
<a href="#L44"> 44</a>
<a href="#L45"> 45</a>
<a href="#L46"> 46</a>
<a href="#L47"> 47</a>
<a href="#L48"> 48</a>
<a href="#L49"> 49</a>
<a href="#L50"> 50</a>
<a href="#L51"> 51</a>
<a href="#L52"> 52</a>
<a href="#L53"> 53</a>
<a href="#L54"> 54</a>
<a href="#L55"> 55</a>
<a href="#L56"> 56</a>
<a href="#L57"> 57</a>
<a href="#L58"> 58</a>
<a href="#L59"> 59</a>
<a href="#L60"> 60</a>
<a href="#L61"> 61</a>
<a href="#L62"> 62</a>
<a href="#L63"> 63</a>
<a href="#L64"> 64</a>
<a href="#L65"> 65</a>
<a href="#L66"> 66</a>
<a href="#L67"> 67</a>
<a href="#L68"> 68</a>
<a href="#L69"> 69</a>
<a href="#L70"> 70</a>
<a href="#L71"> 71</a>
<a href="#L72"> 72</a>
<a href="#L73"> 73</a>
<a href="#L74"> 74</a>
<a href="#L75"> 75</a>
<a href="#L76"> 76</a>
<a href="#L77"> 77</a>
<a href="#L78"> 78</a>
<a href="#L79"> 79</a>
<a href="#L80"> 80</a>
<a href="#L81"> 81</a>
<a href="#L82"> 82</a>
<a href="#L83"> 83</a>
<a href="#L84"> 84</a>
<a href="#L85"> 85</a>
<a href="#L86"> 86</a>
<a href="#L87"> 87</a>
<a href="#L88"> 88</a>
<a href="#L89"> 89</a>
<a href="#L90"> 90</a>
<a href="#L91"> 91</a>
<a href="#L92"> 92</a>
<a href="#L93"> 93</a>
<a href="#L94"> 94</a>
<a href="#L95"> 95</a>
<a href="#L96"> 96</a>
<a href="#L97"> 97</a>
<a href="#L98"> 98</a>
<a href="#L99"> 99</a>
<a href="#L100">100</a>
<a href="#L101">101</a>
<a href="#L102">102</a>
<a href="#L103">103</a>
<a href="#L104">104</a>
<a href="#L105">105</a>
<a href="#L106">106</a>
<a href="#L107">107</a>
<a href="#L108">108</a>
<a href="#L109">109</a>
<a href="#L110">110</a>
<a href="#L111">111</a>
<a href="#L112">112</a>
<a href="#L113">113</a>
<a href="#L114">114</a>
<a href="#L115">115</a>
<a href="#L116">116</a>
<a href="#L117">117</a>
<a href="#L118">118</a>
<a href="#L119">119</a>
<a href="#L120">120</a>
<a href="#L121">121</a>
<a href="#L122">122</a>
<a href="#L123">123</a>
<a href="#L124">124</a>
<a href="#L125">125</a>
<a href="#L126">126</a>
<a href="#L127">127</a>
<a href="#L128">128</a>
<a href="#L129">129</a>
<a href="#L130">130</a>
<a href="#L131">131</a>
<a href="#L132">132</a>
<a href="#L133">133</a>
<a href="#L134">134</a>
<a href="#L135">135</a>
<a href="#L136">136</a>
<a href="#L137">137</a>
<a href="#L138">138</a>
<a href="#L139">139</a>
<a href="#L140">140</a>
<a href="#L141">141</a>
<a href="#L142">142</a>
<a href="#L143">143</a>
<a href="#L144">144</a>
<a href="#L145">145</a>
<a href="#L146">146</a>
<a href="#L147">147</a>
<a href="#L148">148</a>
<a href="#L149">149</a>
<a href="#L150">150</a>
<a href="#L151">151</a>
<a href="#L152">152</a>
<a href="#L153">153</a>
<a href="#L154">154</a>
<a href="#L155">155</a>
<a href="#L156">156</a>
<a href="#L157">157</a>
<a href="#L158">158</a>
<a href="#L159">159</a>
<a href="#L160">160</a>
<a href="#L161">161</a>
<a href="#L162">162</a>
<a href="#L163">163</a>
<a href="#L164">164</a>
<a href="#L165">165</a>
<a href="#L166">166</a>
<a href="#L167">167</a>
<a href="#L168">168</a>
<a href="#L169">169</a>
<a href="#L170">170</a>
<a href="#L171">171</a>
<a href="#L172">172</a>
<a href="#L173">173</a>
<a href="#L174">174</a>
<a href="#L175">175</a>
<a href="#L176">176</a>
<a href="#L177">177</a>
<a href="#L178">178</a>
<a href="#L179">179</a>
<a href="#L180">180</a>
<a href="#L181">181</a>
<a href="#L182">182</a>
<a href="#L183">183</a>
<a href="#L184">184</a>
<a href="#L185">185</a>
<a href="#L186">186</a>
<a href="#L187">187</a>
<a href="#L188">188</a>
<a href="#L189">189</a>
<a href="#L190">190</a>
<a href="#L191">191</a>
<a href="#L192">192</a>
<a href="#L193">193</a>
<a href="#L194">194</a>
<a href="#L195">195</a>
<a href="#L196">196</a>
<a href="#L197">197</a>
<a href="#L198">198</a>
<a href="#L199">199</a>
<a href="#L200">200</a>
<a href="#L201">201</a>
<a href="#L202">202</a>
<a href="#L203">203</a>
<a href="#L204">204</a>
<a href="#L205">205</a>
<a href="#L206">206</a>
<a href="#L207">207</a>
<a href="#L208">208</a>
<a href="#L209">209</a>
<a href="#L210">210</a>
<a href="#L211">211</a>
<a href="#L212">212</a>
<a href="#L213">213</a>
<a href="#L214">214</a>
<a href="#L215">215</a>
<a href="#L216">216</a>
<a href="#L217">217</a>
<a href="#L218">218</a>
<a href="#L219">219</a>
<a href="#L220">220</a>
<a href="#L221">221</a>
<a href="#L222">222</a>
<a href="#L223">223</a>
</pre>
<pre><code class="ocaml">(** This module will contain code for 2nd Degree equation resolution *)

open Ast

(** [convert ast] takes the polynome represented as a recursive type and
    converts it to a type
    [(coefficient:float, (variable:string * power:int) option) list] *)
let convert : polynome -&gt; monome list =
  let rec aux sub = function
    | <span data-count="32">A</span>dd (a, b) -&gt; au<span data-count="32">x</span> sub a @ au<span data-count="32">x</span> false b
    | <span data-count="20">S</span>ub (a, b) -&gt; au<span data-count="20">x</span> sub a @ au<span data-count="20">x</span> true b
    | <span data-count="115">M</span>on (x, v) -&gt;
      if sub then
        <span data-count="20">[</span> (~-<span data-count="20">.</span>x, v) ]
      else
        <span data-count="95">[</span> (x, v) ]
  in
  au<span data-count="1">x</span> false

(** [ast_to_lists (p1, p2)] takes a type [(polynome * polynome)] and calls
    [convert ast] on each polynome to return a [(monome list * monome list)] to
    facilitate manipulation *)
let ast_to_lists ((p1, p2) : polynome * polynome) = <span data-count="31">(</span>conver<span data-count="31">t</span> p1, conver<span data-count="31">t</span> p2)

(** [sqrt x] is a reimplementation of classic sqrt function, it's presence is
    justified by the specifications of the ComputorV1 42 subject *)
let sqrt (x : float) =
  <span data-count="15">l</span>et rec sqrt_aux guess = function
    | <span data-count="15">0</span>. -&gt; guess
    | <span data-count="150">i</span>ter -&gt;
      let guess = guess -. (((guess *. guess) -. x) /. (2. *. guess)) in
      sqrt_aux guess (iter -. 1.)
  in
  sqrt_aux 1. 10.
(*
Alternative, iterative version of the custom SQRT function re-implementation

let sqrt x =
  let z = ref 1. in
  for i = 10 downto 0 do
     begin
       z := !z -. (!z *. !z -. x) /. (2. *. !z)
     end
      done;
   !z
 *)

(** [solve e] takes both monome lists and does all necessary operations that
    lead to solution. Invert all monomes of the righthand side polynome and
    concatenate to lefthand side one. Check for more than one variable, exit if
    so. Create a Hashtable of [(key:power, value:coefficient)]. Check for a
    degree &gt; 2, exit if so. Simplify list by combining same power monomes.
    Proceed to calculate delta and pretty-print the reduced form along with
    polynomial degree and solution(s). *)
let solve fmt (e : monome list * monome list) =
  (* Separate both polynomes of the equation left and right from '=' sign *)
  <span data-count="22">l</span>et left, right = e in
  (* Move right polynome to the left of the '=' sign, invert signs *)
  let right' = List.map (fun (coeff, var) -&gt; <span data-count="26">(</span>~-<span data-count="26">.</span>coeff, var)) right in
  (* Concatenate *)
  <span data-count="22">l</span>et p = left @ right' in
  let seen = ref None in
  (* Scan for presence of more than one variable, exit if there is *)
  List.iter
    (fun (_coeff, var) -&gt;
      <span data-count="74">m</span>atch var with
      | <span data-count="21">N</span>one -&gt; ()
      | <span data-count="53">S</span>ome (var, _n) -&gt; (
        match !seen with
        | <span data-count="20">N</span>one -&gt; seen := Some var
        | <span data-count="33">S</span>ome seen -&gt;
          if seen &lt;&gt; var then <span data-count="1">b</span>egin
            Format.fprintf fmt
              "There are two different variables `%s` and `%s`!@." var seen;
            <span data-count="1">F</span>ormat.fprintf fmt "Won't compute.@.";
            <span data-count="1">r</span>aise Too_many_variables
          end ) )
    p;

  (*
   * Produce new list with monomes matching
   * (coeff:float * (var:string, 0) option)
   * replaced with (1, None)
   *)
  <span data-count="21">l</span>et poly =
    List.map
      (fun (coeff, var) -&gt;
        <span data-count="72">m</span>atch (coeff, var) with
        | <span data-count="21">c</span>oeff, None -&gt; (coeff, var)
        | <span data-count="19">c</span>oeff, Some (_x, 0) -&gt; (coeff, None)
        | <span data-count="32">c</span>oeff, Some (_x, _n) -&gt; (coeff, var) )
      p
  in

  (*
   * Create hashtable
   * Keys are Power to which a given coefficient(varible option) is raised
   * Values are the said coefficients
   *
   * Add coefficients of same power together to simplify polynome
   *)
  <span data-count="21">l</span>et tbl = Hashtbl.create 512 in
  <span data-count="21">L</span>ist.iter
    (fun (coeff, var) -&gt;
      <span data-count="72">m</span>atch var with
      | <span data-count="40">N</span>one -&gt; (
        let x = Hashtbl.find_opt tbl 0 in
        <span data-count="40">m</span>atch x with
        | <span data-count="21">N</span>one -&gt; Hashtbl.add tbl 0 coeff
        | <span data-count="19">S</span>ome x -&gt; Hashtbl.replace tbl 0 (coeff +. x) )
      | <span data-count="32">S</span>ome (_var, n) -&gt; (
        let x = Hashtbl.find_opt tbl n in
        <span data-count="32">m</span>atch x with
        | <span data-count="28">N</span>one -&gt; Hashtbl.replace tbl n coeff
        | <span data-count="4">S</span>ome x -&gt; Hashtbl.replace tbl n (coeff +. x) ) )
    poly;

  <span data-count="21">l</span>et var = Option.value !seen ~default:"" in
  (* Convert all Hashtbl of monomes (key:power, value:coef) to a list of (power, coef)*)
  <span data-count="21">l</span>et allterms = List.of_seq (Hashtbl.to_se<span data-count="21">q</span> tbl) in
  (* Order in growing order of (power, _coef) *)
  <span data-count="21">l</span>et sorted_terms =
    List.sort (fun (pow1, _) (pow2, _) -&gt; <span data-count="39">I</span>nt.compare pow1 pow2) allterms
  in
  (* Filter out the monomes that have a coef of 0 *)
  <span data-count="21">l</span>et filtered_terms = List.filter (fun x -&gt; <span data-count="49">s</span>n<span data-count="49">d</span> x &lt;&gt; 0.) sorted_terms in
  (* Find highest degree with non null coefficient *)
  <span data-count="21">l</span>et max_degree =
    try fs<span data-count="18">t</span> (List.h<span data-count="18">d</span> (List.re<span data-count="21">v</span> filtered_terms)) with
    | <span data-count="3">F</span>ailure _ -&gt; 0
  in
  (* Raise an exception in case of degree &gt; 2 *)
  if max_degree &gt; 2 then <span data-count="1">b</span>egin
    Format.fprintf fmt "Reduced form: %a" Pp.equ (filtered_terms, [], var);
    <span data-count="1">F</span>ormat.fprintf fmt "Polynomial degree: %d@." max_degree;
    <span data-count="1">F</span>ormat.fprintf fmt
      "The polynomial degree is strictly greater than 2, I can't solve.@.";
    <span data-count="1">r</span>aise Big_degree
  end;

  <span data-count="20">l</span>et a = Option.value (Hashtbl.find_op<span data-count="20">t</span> tbl 2) ~default:0. in
  <span data-count="20">l</span>et b = Option.value (Hashtbl.find_op<span data-count="20">t</span> tbl 1) ~default:0. in
  <span data-count="20">l</span>et c = Option.value (Hashtbl.find_op<span data-count="20">t</span> tbl 0) ~default:0. in
  <span data-count="20">l</span>et normalize fmt root =
    <span data-count="4">F</span>ormat.fprintf fmt "%g"
      ( if Float.compar<span data-count="4">e</span> (-0.) root = 0 then
        <span data-count="1">F</span>loat.ab<span data-count="1">s</span> root
      else
        <span data-count="3">r</span>oot )
  in
  (* If a is not 0, then it's not a 2nd degree equation *)
  if a &lt;&gt; 0. then <span data-count="12">(</span>
    (* Calculating delta for resolution of
     * 2nd Degree equation
     *)
    let delta = (b *. b) -. (4. *. a *. c) in
    let normalize fmt root =
      <span data-count="21">F</span>ormat.fprintf fmt "%g"
        ( if Float.compar<span data-count="21">e</span> (-0.) root = 0 then
          <span data-count="3">F</span>loat.ab<span data-count="3">s</span> root
        else
          <span data-count="18">r</span>oot )
    in
    match delta with
    | <span data-count="3">0</span>. -&gt;
      (* Delta is null, there is only one possible solution *)
      let solution = ~-<span data-count="3">.</span>b /. (2. *. a) in
      Format.fprintf fmt "Reduced form: %a@." Pp.equ (filtered_terms, [], var);
      <span data-count="3">F</span>ormat.fprintf fmt "Polynomial degree: %d@." max_degree;
      <span data-count="3">P</span>p.deltap fmt delta;
      <span data-count="3">F</span>ormat.fprintf fmt "%a@." normalize solution
      (* Delta is positive, 2 solutions possible *)
    | <span data-count="9">d</span>elta when Float.compar<span data-count="9">e</span> 0. delta &lt; 0 -&gt;
      <span data-count="6">l</span>et solution1 = (~-<span data-count="6">.</span>b -. sqr<span data-count="6">t</span> delta) /. (2. *. a) in
      let solution2 = (~-<span data-count="6">.</span>b +. sqr<span data-count="6">t</span> delta) /. (2. *. a) in
      Format.fprintf fmt "Reduced form: %a@." Pp.equ (filtered_terms, [], var);
      <span data-count="6">F</span>ormat.fprintf fmt "Polynomial degree: %d@." max_degree;
      <span data-count="6">P</span>p.deltap fmt delta;
      <span data-count="6">F</span>ormat.fprintf fmt "%a@.%a@." normalize solution1 normalize solution2
      (* Solutions are found in complex numbers *)
    | <span data-count="3">d</span>elta -&gt;
      let reduce_zi fmt root =
        <span data-count="6">i</span>f Float.compar<span data-count="6">e</span> (-0.) root = 0 then
          <span data-count="0">n</span>ormalize fmt root
        else <span data-count="6">i</span>f Float.compar<span data-count="6">e</span> 1. root = 0 then
          <span data-count="2">F</span>ormat.fprintf fmt ""
        else
          <span data-count="4">F</span>ormat.fprintf fmt "%g" root
      in
      Format.fprintf fmt "Reduced form: %a@." Pp.equ (filtered_terms, [], var);
      <span data-count="3">F</span>ormat.fprintf fmt "Polynomial degree: %d@." max_degree;
      <span data-count="3">P</span>p.deltap fmt delta;
      <span data-count="3">l</span>et root1 = ~-<span data-count="3">.</span>b /. (2. *. a) in
      let root2 = sqr<span data-count="3">t</span> ~-<span data-count="3">.</span>delta /. (2. *. a) in
      Format.fprintf fmt "%a - %ai@." normalize root1 reduce_zi root2;
      <span data-count="3">F</span>ormat.fprintf fmt "%a + %ai@." normalize root1 reduce_zi root2
  ) else
    (* Calculating x for resolution of
     * 1st or 0th Degree equation
     *)
    <span data-count="8">m</span>atch b with
    | <span data-count="4">0</span>. -&gt; (
      match c with
      (* Case 0 = 0
      *)
      | <span data-count="3">0</span>. -&gt;
        Format.fprintf fmt "Reduced form: 0 = 0@.";
        <span data-count="3">F</span>ormat.fprintf fmt "Polynomial degree: %d@." max_degree;
        <span data-count="3">P</span>p.deltap fmt 0.;
        <span data-count="3">F</span>ormat.fprintf fmt "All real numbers are solutions.\n"
      (* Case 3 = 0
      *)
      | <span data-count="1">_</span>c -&gt;
        Format.fprintf fmt "Reduced form: %a@." Pp.equ (filtered_terms, [], var);
        <span data-count="1">F</span>ormat.fprintf fmt "Impossible.@." )
    (* Case x = -c/b
  *)
    | <span data-count="4">b</span> -&gt;
      let solution = ~-<span data-count="4">.</span>c /. b in
      Format.fprintf fmt "Reduced form: %a@." Pp.equ (filtered_terms, [], var);
      <span data-count="4">F</span>ormat.fprintf fmt "Polynomial degree: %d@." max_degree;
      <span data-count="4">P</span>p.deltap fmt 0.;
      <span data-count="4">F</span>ormat.fprintf fmt "%a@." normalize solution
</code></pre>
      </div>
    </div>
    <script src="../coverage.js"></script>
  </body>
</html>
